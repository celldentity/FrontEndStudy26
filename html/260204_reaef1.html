<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ˆìµœì í™” ë°˜ì‘í˜• ì›¹ í˜ì´ì§€</title>

    <link rel="stylesheet" href="base.css">
    <link rel="stylesheet" href="mobile.css" media="(max-width: 767px)">
    <link rel="stylesheet" href="tablet.css" media="(min-width: 768px) and (max-width: 1023px)">
    <link rel="stylesheet" href="desktop.css" media="(min-width: 1024px)">

    <style>
        :root { font-family: sans-serif; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        /* íˆì–´ë¡œ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .hero-image {
            width: 100%;
            height: auto;
            display: block;
            margin-bottom: 40px;
            background-color: #eee; /* ë¡œë”© ì „ ë°°ê²½ìƒ‰ */
        }

        /* 2. ì§€ì—° ë¡œë”©(Lazy Loading) ìŠ¤íƒ€ì¼ */
        .lazy-image {
            width: 100%;
            height: 400px; /* ê³ ì • ë†’ì´ë¥¼ ì£¼ì–´ ë ˆì´ì•„ì›ƒ ì‹œí”„íŠ¸ ë°©ì§€ */
            background-color: #f0f0f0;
            margin-bottom: 20px;
            opacity: 0;
            transition: opacity 0.5s ease;
            object-fit: cover;
            display: block;
        }

        .lazy-image.loaded {
            opacity: 1;
            height: auto; /* ë¡œë“œ í›„ ë†’ì´ ë³µêµ¬ */
            min-height: 300px;
        }

        .placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px dashed #ccc;
            color: #666;
        }

        .section-title { margin-top: 50px; border-bottom: 2px solid #333; padding-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ë°˜ì‘í˜• ë° ì„±ëŠ¥ ìµœì í™” ì‹œìŠ¤í…œ</h1>

    <section>
        <h2>ë°˜ì‘í˜• íˆì–´ë¡œ ì´ë¯¸ì§€</h2>
        <img src="https://via.placeholder.com/1200x600?text=Default+Hero"
             srcset="https://via.placeholder.com/480x300?text=Mobile+Hero 480w,
                     https://via.placeholder.com/768x450?text=Tablet+Hero 768w,
                     https://via.placeholder.com/1200x600?text=Desktop+Hero 1200w"
             sizes="(max-width: 480px) 100vw,
                    (max-width: 768px) 100vw,
                    1200px"
             alt="ë©”ì¸ íˆì–´ë¡œ ì´ë¯¸ì§€"
             class="hero-image">
    </section>

    <section>
        <h2 class="section-title">ì§€ì—° ë¡œë”© ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸</h2>
        <p>ìŠ¤í¬ë¡¤ì„ ì•„ë˜ë¡œ ë‚´ë ¤ë³´ì„¸ìš”. ì´ë¯¸ì§€ê°€ ë·°í¬íŠ¸ì— ë“¤ì–´ì˜¬ ë•Œ ë¡œë“œë©ë‹ˆë‹¤.</p>

        <img class="lazy-image placeholder"
             data-src="https://via.placeholder.com/800x600/3498db/fff?text=Image+1"
             alt="ì´ë¯¸ì§€ 1">

        <img class="lazy-image placeholder"
             data-src="https://via.placeholder.com/800x600/e74c3c/fff?text=Image+2"
             alt="ì´ë¯¸ì§€ 2">

        <img class="lazy-image placeholder"
             data-src="https://via.placeholder.com/800x600/2ecc71/fff?text=Image+3"
             alt="ì´ë¯¸ì§€ 3">
    </section>
</div>

<script>
/**
 * 5. JavaScript ì„±ëŠ¥ ìµœì í™” í´ë˜ìŠ¤
 */
class PerformanceOptimizer {
    constructor() {
        this.isMobile = window.innerWidth <= 768;
        this.isRetina = window.devicePixelRatio > 1;
        this.connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
    }

    // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸ (ëŠë¦° ì—°ê²° ì—¬ë¶€)
    isSlowConnection() {
        if (!this.connection) return false;
        // 4G ë¯¸ë§Œ(3G, 2G ë“±)ì¸ ê²½ìš° true ë°˜í™˜
        return this.connection.effectiveType === 'slow-2g' ||
               this.connection.effectiveType === '2g' ||
               this.connection.effectiveType === '3g';
    }

    // ì¡°ê±´ë¶€ ë¦¬ì†ŒìŠ¤ ë¡œë”© ì‹¤í–‰
    loadConditionalResources() {
        if (this.isSlowConnection()) {
            console.log("âš ï¸ ëŠë¦° ë„¤íŠ¸ì›Œí¬ ê°ì§€: ê³ í•´ìƒë„ ì´ë¯¸ì§€ë¥¼ ì œí•œí•©ë‹ˆë‹¤.");
            this.disableHighResImages();
        }

        if (this.isMobile) {
            console.log("ğŸ“± ëª¨ë°”ì¼ í™˜ê²½ ìµœì í™” ê¸°ëŠ¥ì„ ë¡œë“œí•©ë‹ˆë‹¤.");
            // ì‹¤ì œ ê²½ë¡œê°€ ìˆì„ ê²½ìš° import ì‹¤í–‰
            // this.loadMobileOptimizedFeatures();
        } else {
            console.log("ğŸ’» ë°ìŠ¤í¬í†± í™˜ê²½ ê¸°ëŠ¥ì„ ë¡œë“œí•©ë‹ˆë‹¤.");
            // this.loadDesktopFeatures();
        }
    }

    disableHighResImages() {
        const images = document.querySelectorAll('img[srcset]');
        images.forEach(img => {
            const basicSrc = img.src;
            img.removeAttribute('srcset');
            img.src = basicSrc;
        });
    }

    // ì§€ì—° ë¡œë”© ì´ˆê¸°í™” (Intersection Observer)
    initLazyLoading() {
        const lazyImages = document.querySelectorAll('.lazy-image');

        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    const src = img.getAttribute('data-src');

                    // ì´ë¯¸ì§€ ì†ŒìŠ¤ êµì²´
                    img.src = src;
                    img.onload = () => {
                        img.classList.add('loaded');
                        img.classList.remove('placeholder');
                    };

                    // ê´€ì°° ì¤‘ë‹¨
                    observer.unobserve(img);
                }
            });
        }, {
            rootMargin: '0px 0px 200px 0px' // í™”ë©´ì— ë³´ì´ê¸° 200px ì „ì— ë¯¸ë¦¬ ë¡œë“œ ì‹œì‘
        });

        lazyImages.forEach(img => imageObserver.observe(img));
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ìµœì í™” ì‹¤í–‰
document.addEventListener('DOMContentLoaded', () => {
    const optimizer = new PerformanceOptimizer();
    optimizer.loadConditionalResources();
    optimizer.initLazyLoading();
});
</script>

</body>
</html>